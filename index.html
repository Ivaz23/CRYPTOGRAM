<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞–º–º–∞: –ó–∏–º–Ω–∏–µ –¢–∞–π–Ω—ã</title>
    <script src="https://yandex.ru/games/sdk/v2"></script>
    <style>
        :root {
            --bg-color: #d6e4f0;
            --card: rgba(255, 255, 255, 0.98);
            --primary: #c0392b; 
            --correct: #27ae60;
            --error: #e74c3c;
            --text: #2c3e50;
            --border: #d1d5db;
            --hint: #2980b9;
        }

        /* –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–ø. 1.6.1.8, 1.6.2.7) */
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            outline: none;
        }

        /* –ó–∞–ø—Ä–µ—Ç —Å–∫—Ä–æ–ª–ª–∞ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø. 1.10.1) */
        html, body {
            margin: 0; padding: 0; 
            width: 100%; height: 100%;
            height: -webkit-fill-available;
            overflow: hidden; 
            background-color: var(--bg-color);
            overscroll-behavior: none;
        }

        body {
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex; 
            flex-direction: column;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Cpath d='M30 5 L38 22 L32 22 L45 38 L35 38 L35 50 L25 50 L25 38 L15 38 L28 22 L22 22 Z' fill='%2327ae60' fill-opacity='0.1'/%3E%3C/svg%3E");
            background-attachment: fixed;
        }

        #snow-container { position: fixed; inset: 0; pointer-events: none; z-index: 100; }
        .snowflake { position: absolute; top: -10px; color: white; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }

        /* HEADER - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        header {
            height: 50px; background: #fff;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100; flex-shrink: 0;
        }
        .stats { display: flex; gap: 15px; font-weight: 800; font-size: 0.85rem; }
        .lives { color: var(--primary); letter-spacing: 1px; }

        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï - –ì–∏–±–∫–∞—è –≤—ã—Å–æ—Ç–∞ (—Å–∫—Ä–æ–ª–ª–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏) */
        main {
            flex: 1; /* –ó–∞–±–∏—Ä–∞–µ—Ç –≤—Å—ë –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            overflow-y: auto; 
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            padding: 15px 10px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        #puzzle-container {
            display: flex; flex-wrap: wrap; justify-content: center;
            align-content: flex-start; gap: 8px; width: 100%;
        }

        .word { display: flex; gap: 4px; margin-right: 15px; margin-bottom: 22px; }
        .author-div { border-top: 2px dashed #95a5a6; padding-top: 15px; margin-top: 10px; width: 100%; display: flex; justify-content: center; flex-wrap: wrap; }

        .cell { 
            width: clamp(34px, 8.5vw, 48px); display: flex; flex-direction: column; 
            align-items: center; cursor: pointer; transition: transform 0.1s;
        }
        .box {
            width: 100%; aspect-ratio: 1/1.1; background: var(--card);
            border: 2px solid var(--border); border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: clamp(1rem, 5.5vw, 1.6rem); font-weight: 900;
        }
        .num { margin-top: 4px; font-size: 0.65rem; color: #555; font-weight: 900; }

        .cell.sel .box { border-color: var(--primary); background: #fff; transform: scale(1.05); box-shadow: 0 0 10px rgba(192,57,43,0.3); }
        .cell.ok .box { color: var(--correct); border-color: var(--correct); }
        .cell.bad .box { color: var(--error); border-color: var(--error); animation: sh 0.3s; }

        @keyframes sh { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-4px);} 75%{transform:translateX(4px);} }

        /* –ö–õ–ê–í–ò–ê–¢–£–†–ê –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï - –ü—Ä–∏–∂–∞—Ç–æ –∫ –Ω–∏–∑—É, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ */
        #footer {
            flex-shrink: 0; background: rgba(255,255,255,0.95);
            padding: 8px 8px calc(8px + env(safe-area-inset-bottom));
            border-radius: 20px 20px 0 0; width: 100%; max-width: 600px;
            margin: 0 auto; box-shadow: 0 -3px 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .kbd-row { display: flex; justify-content: center; gap: 4px; margin-bottom: 5px; }
        .key {
            background: #fff; height: clamp(40px, 7vh, 52px); flex: 1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: clamp(0.8rem, 4vw, 1.2rem);
            cursor: pointer; border: 1px solid #ddd; box-shadow: 0 2px 0 #ccc;
        }
        .key:active { transform: translateY(1px); box-shadow: none; }
        .key.faded { opacity: 0.1; pointer-events: none; }

        .hint-btn { background: var(--hint); color: #fff; border: none; padding: 10px; border-radius: 12px; font-weight: 900; cursor: pointer; text-align: center; width: 100%; font-size: 10px; margin-top: 5px;}

        /* –≠–ö–†–ê–ù–´ */
        .ovl {
            position: fixed; inset: 0; z-index: 500; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white; padding: 30px; text-align: center;
        }
        .btn { background: var(--correct); color: white; border: none; padding: 18px 50px; border-radius: 40px; font-size: 1.4rem; font-weight: 900; cursor: pointer; margin-top: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }

        @media (orientation: landscape) and (min-width: 700px) {
            body { flex-direction: row; }
            header { position: absolute; top:0; width: 100%; }
            main { padding-top: 60px; }
            #footer { width: 320px; border-radius: 20px; margin: auto 15px; }
        }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="snow-container"></div>

<!-- –≠–∫—Ä–∞–Ω—ã -->
<div id="sc-menu" class="ovl" style="display: flex;">
    <div style="font-size: 4rem;">‚ùÑÔ∏è</div>
    <h1 style="font-size: 2.2rem; margin: 0;">–ö–†–ò–ü–¢–û–ì–†–ê–ú–ú–ê:<br>–ó–ò–ú–ù–ò–ï –¢–ê–ô–ù–´</h1>
    <div style="margin: 15px 0; font-size: 1.1rem; color: #f1c40f; font-weight: 900;">üèÜ –†–ï–ö–û–†–î: <span id="ui-record">0</span></div>
    <button class="btn" onclick="start()">–ò–ì–†–ê–¢–¨</button>
</div>

<div id="sc-fail" class="ovl" style="background: var(--primary);">
    <h2 style="font-size: 3rem;">–ü–û–ü–´–¢–ö–ò –ó–ê–ö–û–ù–ß–ò–õ–ò–°–¨</h2>
    <button class="btn" style="background: #fff; color: var(--primary);" onclick="location.reload()">–í –ú–ï–ù–Æ</button>
</div>

<div id="sc-win" class="ovl">
    <h2>–†–ê–ó–ì–ê–î–ê–ù–û!</h2>
    <p id="ui-auth-name" style="color:#f1c40f; font-weight:900; font-size: 1.5rem;"></p>
    <button class="btn" onclick="next()">–î–ê–õ–ï–ï</button>
</div>

<!-- –•–µ–¥–ª–µ—Ä –≥–µ–π–º–ø–ª–µ—è -->
<header id="h-ui" style="display:none;">
    <div class="stats">
        <span>‚≠ê <span id="s-val">0</span></span>
        <span class="lives" id="l-val">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
    </div>
    <div style="font-size: 0.6rem; opacity: 0.5; font-weight: 900;">–ó–ò–ú–ù–ò–ï –¢–ê–ô–ù–´</div>
    <button onclick="location.reload()" style="background:none; border:none; font-size: 1.4rem; cursor:pointer;">üè†</button>
</header>

<main id="m-ui" style="display:none;">
    <div id="puzzle-container"></div>
</main>

<div id="f-ui" style="display:none;">
    <div id="kbd"></div>
    <button class="hint-btn" onclick="hint()">–û–¢–ö–†–´–¢–¨ –≠–¢–£ –Ø–ß–ï–ô–ö–£ (–°–ú–û–¢–†–ï–¢–¨ –†–ï–ö–õ–ê–ú–£)</button>
</div>

<script>
    const phrases = [
        {q: "–í–û–û–ë–†–ê–ñ–ï–ù–ò–ï –í–ê–ñ–ù–ï–ï –ó–ù–ê–ù–ò–ô", a: "–ê–õ–¨–ë–ï–†–¢ –≠–ô–ù–®–¢–ï–ô–ù"},
        {q: "–Ø –î–£–ú–ê–Æ –ó–ù–ê–ß–ò–¢ –Ø –°–£–©–ï–°–¢–í–£–Æ", a: "–†–ï–ù–ï –î–ï–ö–ê–†–¢"},
        {q: "–í –°–û–í–ï–†–®–ï–ù–°–¢–í–ï –ù–ï–¢ –ù–ò–ß–ï–ì–û –ú–ê–õ–ï–ù–¨–ö–û–ì–û", a: "–ú–ò–ö–ï–õ–ê–ù–î–ñ–ï–õ–û"},
        {q: "–ñ–ò–ó–ù–¨ –≠–¢–û –¢–û –ß–¢–û –°–õ–£–ß–ê–ï–¢–°–Ø –ü–û–ö–ê –í–´ –°–¢–†–û–ò–¢–ï –ü–õ–ê–ù–´", a: "–î–ñ–û–ù –õ–ï–ù–ù–û–ù"},
        {q: "–ù–ò–ö–û–ì–î–ê –ù–ï –ü–†–ï–†–´–í–ê–ô–¢–ï –í–†–ê–ì–ê –ö–û–ì–î–ê –û–ù –û–®–ò–ë–ê–ï–¢–°–Ø", a: "–ù–ê–ü–û–õ–ï–û–ù"}
    ];
    const layouts = {
        ru: ["–ô–¶–£–ö–ï–ù–ì–®–©–ó–•–™", "–§–´–í–ê–ü–†–û–õ–î–ñ–≠", "–Ø–ß–°–ú–ò–¢–¨–ë–Æ–Å"],
        en: ["QWERTYUIOP", "ASDFGHJKL", "ZXCVBNM"]
    };

    let sdk, p_obj, p_data = [], c_map = {}, selIdx = 0, score = 0, best = 0, lives = 3, lang = 'ru';

    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã –¥–ª—è –º–æ–±–∏–ª–æ–∫ (–ø. 1.10.1)
    const fixH = () => {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    };
    window.addEventListener('resize', fixH); fixH();

    // 1. SDK INIT
    if (typeof YaGames !== 'undefined') {
        YaGames.init().then(y => {
            sdk = y;
            lang = sdk.environment.i18n.lang.startsWith('ru') ? 'ru' : 'en';
            if (sdk.features?.LoadingAPI) sdk.features.LoadingAPI.ready();
            best = localStorage.getItem('cry_best_z') || 0;
            document.getElementById('ui-record').innerText = best;
        });
    }

    function start() {
        document.getElementById('sc-menu').style.display = 'none';
        document.getElementById('h-ui').style.display = 'flex';
        document.getElementById('m-ui').style.display = 'flex';
        document.getElementById('f-ui').style.display = 'block';
        initLvl();
    }

    function initLvl() {
        lives = 3; score = 0;
        p_obj = phrases[Math.floor(Math.random() * phrases.length)];
        p_data = []; c_map = {}; 
        const full = (p_obj.q + p_obj.a).replace(/\s/g, '');
        const uni = [...new Set(full.split(''))];
        const nums = Array.from({length: 60}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
        uni.forEach((l, i) => c_map[l] = nums[i]);

        [...p_obj.q].forEach(c => addC(c));
        p_data.push({ isDiv: true });
        [...p_obj.a].forEach(c => addC(c));

        // –ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ 2—Ö –±—É–∫–≤
        const auto = uni.sort(() => Math.random() - 0.5).slice(0, 2);
        p_data.forEach(p => { if(!p.isSp && !p.isDiv && auto.includes(p.corr)) p.usr = p.corr; });

        move(0); upd();
    }

    function addC(c) {
        if (c === ' ') p_data.push({ isSp: true });
        else p_data.push({ corr: c, num: c_map[c], usr: '' });
    }

    function upd() {
        const cont = document.getElementById('puzzle-container'); cont.innerHTML = '';
        let row = docR();
        p_data.forEach((p, i) => {
            if (p.isDiv) {
                cont.appendChild(row); 
                const d = document.createElement('div'); d.className = 'author-div';
                cont.appendChild(d); row = d; return;
            }
            if (p.isSp) { cont.appendChild(row); row = docR(); return; }
            const cell = document.createElement('div');
            cell.className = `cell ${i === selIdx ? 'sel' : ''} ${p.usr === p.corr ? 'ok' : ''}`;
            cell.innerHTML = `<div class="box">${p.usr}</div><div class="num">${p.num}</div>`;
            cell.onclick = () => { selIdx = i; upd(); };
            row.appendChild(cell);
        });
        cont.appendChild(row);

        const kArea = document.getElementById('kbd'); kArea.innerHTML = '';
        layouts[lang].forEach(rStr => {
            const div = document.createElement('div'); div.className = 'kbd-row';
            rStr.split('').forEach(l => {
                const k = document.createElement('div'); k.className = 'key';
                if (isFin(l)) k.classList.add('faded');
                k.innerText = l; k.onclick = () => tap(l);
                div.appendChild(k);
            });
            kArea.appendChild(div);
        });

        document.getElementById('l-val').innerText = "‚ù§Ô∏è".repeat(lives);
        document.getElementById('s-val').innerText = score;
        if(score > best) { best = score; localStorage.setItem('cry_best_z', best); }
        win();
    }

    function isFin(l) {
        const pool = p_data.filter(p => p.corr === l);
        return pool.length > 0 && pool.every(p => p.usr === l);
    }

    function tap(l) {
        const data = p_data[selIdx];
        if(!data || data.usr) return;
        if (l === data.corr) { data.usr = l; score += 10; move(selIdx + 1); }
        else {
            lives--; 
            const cells = document.querySelectorAll('.cell');
            let v = 0; for(let i=0; i<selIdx; i++) if(!p_data[i].isSp && !p_data[i].isDiv) v++;
            if(cells[v]) { cells[v].classList.add('bad'); setTimeout(upd, 300); }
            if (lives <= 0) document.getElementById('sc-fail').style.display = 'flex';
        }
        upd();
    }

    function move(s) {
        for(let i=s; i<p_data.length; i++) if(!p_data[i].isSp && !p_data[i].isDiv && !p_data[i].usr) { selIdx = i; return; }
        for(let i=0; i<s; i++) if(!p_data[i].isSp && !p_data[i].isDiv && !p_data[i].usr) { selIdx = i; return; }
    }

    function win() {
        if(p_data.length > 0 && p_data.every(p => p.isSp || p.isDiv || p.usr === p.corr)) {
            document.getElementById('ui-auth-name').innerText = "‚Äî " + p_obj.a;
            document.getElementById('sc-win').style.display = 'flex';
        }
    }

    function hint() {
        if (!sdk) { execH(); return; }
        sdk.adv.showRewardedVideo({ callbacks: { onRewarded: execH } });
    }

    function execH() {
        const p = p_data[selIdx];
        if (p && !p.usr) { p.usr = p.corr; score += 5; move(selIdx + 1); upd(); }
    }

    function next() {
        document.getElementById('sc-win').style.display = 'none';
        if (sdk) sdk.adv.showFullscreenAdv({ callbacks: { onClose: initLvl } }); else initLvl();
    }

    function docR() { const d = document.createElement('div'); d.className = 'word'; return d; }
    
    window.addEventListener('keydown', (e) => {
        const k = e.key.toUpperCase();
        if(layouts[lang].join('').includes(k)) tap(k);
    });

    setInterval(() => {
        const sf = document.createElement('div');
        sf.className = 'snowflake'; sf.innerText = '‚ùÑ';
        sf.style.left = Math.random() * 100 + 'vw';
        sf.style.animationDuration = (Math.random() * 3 + 3) + 's';
        document.getElementById('snow-container').appendChild(sf);
        setTimeout(() => sf.remove(), 4000);
    }, 400);
</script>
</body>
</html>
